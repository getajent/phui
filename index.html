<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planet Hoarders</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Press+Start+2P&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <!-- CRT screen effect overlays -->
    <div class="crt-overlay"></div>
    <div class="scanlines"></div>
    <div class="noise"></div>
    <div class="flicker"></div>
    
    <!-- Dense Volumetric Fog (Below UI) -->
    <div class="fog-container">
        <div class="fog-layer fog-layer-1"></div>
        <div class="fog-layer fog-layer-2"></div>
        <div class="fog-layer fog-layer-3"></div>
        <div class="fog-layer fog-layer-4"></div>
    </div>
    
    <!-- Electrical Spark Effect -->
    <div class="electrical-spark-container" id="electricalSparks">
        <canvas id="sparkCanvas"></canvas>
        <div class="spark-flash"></div>
    </div>
    
    <div class="game-ui">
        <!-- Low Health Overlay -->
        <div class="low-health-overlay"></div>
        
        <!-- Draggable Element -->
        <div class="draggable-container">
            <div class="draggable-element" id="draggableElement">
                <div class="drag-scratches"></div>
                <i class="fa-solid fa-satellite-dish"></i>
                <span class="drag-label">SIGNAL</span>
            </div>
        </div>
        
        <!-- Drag Hint -->
        <div class="drag-hint" id="dragHint">
            <div class="scan-line"></div>
            <div class="warning-icon">
                <i class="fa-solid fa-bolt"></i>
            </div>
            <div class="hint-content" id="dragInitialContent">
                <div class="hint-icon">
                    <i class="fa-solid fa-hand-fist"></i>
                </div>
                <div class="hint-text-container">
                    <div class="hint-text">CLICK AND DRAG</div>
                    <div class="hint-subtext">SPATIAL ANOMALY DETECTED</div>
                </div>
            </div>
            <div class="hint-content" id="dragActiveContent" style="display: none;">
                <div class="hint-icon">
                    <i class="fa-solid fa-hand"></i>
                </div>
                <div class="hint-text-container">
                    <div class="hint-text">RELEASE TO DROP</div>
                    <div class="hint-subtext">ANOMALY REPOSITIONING</div>
                </div>
            </div>
            <div class="corner-decoration"></div>
            <div class="hint-warning-label">CAUTION: UNSTABLE</div>
            <div class="corner-element top-left"></div>
            <div class="corner-element top-right"></div>
            <div class="corner-element bottom-left"></div>
            <div class="corner-element bottom-right"></div>
        </div>
        
        <!-- Health/Stamina Bars -->
        <div class="top-left">
            <div class="vitals-container">
                <div class="vital-bar-container">
                    <i class="fa-solid fa-heart icon-vital health-icon"></i>
                    <div class="vital-bar health-bar">
                        <div class="vital-fill health-fill">
                            <div class="vital-pulse"></div>
                        </div>
                    </div>
                </div>
                <div class="vital-bar-container">
                    <i class="fa-solid fa-running icon-vital stamina-icon"></i>
                    <div class="vital-bar stamina-bar">
                        <div class="vital-fill stamina-fill">
                            <div class="vital-pulse"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Time Display - Made to look broken -->
        <div class="time-display">
            <div class="time-container broken">
                <i class="fa-regular fa-clock time-icon"></i>
                <div class="time-wrapper">
                    <span id="game-time">13:45</span>
                    <span class="time-period">PM</span>
                </div>
            </div>
            <!-- Total Monster Cost Display -->
            <div class="total-cost-container">
                <i class="fa-solid fa-dragon cost-icon"></i>
                <div class="cost-wrapper">
                    <span id="total-monster-cost">999</span>
                    <span class="cost-currency">$</span>
                </div>
            </div>
        </div>
        
        <!-- Dead Players Toggle Button -->
        <div class="dead-players-toggle" id="deadPlayersToggle">
            <div class="toggle-icon">
                <i class="fa-solid fa-skull"></i>
            </div>
            <div class="toggle-label">DECEASED</div>
            <div class="toggle-count">3</div>
        </div>

        <!-- Mission Directive Panel (Previously Objectives) -->
        <div class="objectives-container">
            <div class="objectives-hint">
                <i class="fa-solid fa-list-check"></i>
                <span>DIRECTIVE</span>
                <div class="key-hint">TAB</div>
                <div class="notification-dot"></div>
            </div>
            <div id="objectives-panel" class="objectives-panel">
                <div class="objectives-header">
                    <span data-text="MANDATORY TASK LIST">MANDATORY TASK LIST</span>
                    <div class="objectives-counter">1/3</div>
                </div>
                <div class="objective">
                    <div class="objective-icon-container">
                        <i class="fa-solid fa-location-dot icon-objective"></i>
                    </div>
                    <div class="objective-content">
                        <div class="objective-text">DESCENT INTO MADNESS</div>
                        <div class="objective-subtext">Locate the maintenance tunnels (or become one with the walls)</div>
                        <div class="progress-indicator">
                            <div class="progress-track"></div>
                            <div class="progress-fill" style="width: 30%"></div>
                        </div>
                    </div>
                </div>
                <div class="objective">
                    <div class="objective-icon-container">
                        <i class="fa-solid fa-location-dot icon-objective"></i>
                    </div>
                    <div class="objective-content">
                        <div class="objective-text">RESOURCE EXTRACTION</div>
                        <div class="objective-subtext">Harvest alien flora samples <span class="progress-counter">[0/3]</span> (Your suffering is tax-deductible)</div>
                        <div class="progress-indicator">
                            <div class="progress-track"></div>
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="objective completed">
                    <div class="objective-icon-container">
                        <i class="fa-solid fa-check icon-objective"></i>
                    </div>
                    <div class="objective-content">
                        <div class="objective-text">SIGNAL INVESTIGATION</div>
                        <div class="objective-subtext">Trace the source of the distress signal (Your screams will be analyzed for research)</div>
                        <div class="progress-indicator">
                            <div class="progress-track"></div>
                            <div class="progress-fill" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                <div class="objective-footer">
                    <div class="scan-line"></div>
                    <div class="connection-status">CONNECTION TO HR ESTABLISHED • YOUR PAIN IS BEING MONITORED</div>
                </div>
            </div>
        </div>

        <!-- Voice Level Indicator -->
        <div class="voice-level-indicator" id="voiceLevelIndicator">
            <div class="voice-level-icon">
                <i class="fa-solid fa-microphone"></i>
                <div class="voice-level-bars">
                    <div class="voice-bar" data-bar="1"></div>
                    <div class="voice-bar" data-bar="2"></div>
                    <div class="voice-bar" data-bar="3"></div>
                    <div class="voice-bar" data-bar="4"></div>
                    <div class="voice-bar" data-bar="5"></div>
                </div>
            </div>
            <div class="voice-status-text">MIC OK</div>
        </div>

        <!-- Equipment Bar -->
        <div class="equipment-bar">
            <div class="equipment-slot flashlight-slot off" data-slot="1">
                <div class="slot-content">
                    <i class="fa-solid fa-lightbulb icon-main"></i>
                    <div class="battery-indicator">
                        <div class="battery-fill"></div>
                    </div>
                    <div class="status-indicator flashlight-status"></div>
                </div>
            </div>
            <div class="equipment-slot empty-slot error" data-slot="2">
                <div class="slot-content">
                    <div class="error-text">ERROR</div>
                    <div class="warning-tape"></div>
                </div>
            </div>
            <div class="equipment-slot firstaid-slot" data-slot="3">
                <div class="slot-content">
                    <i class="fa-solid fa-first-aid icon-main"></i>
                    <div class="scratches"></div>
                </div>
            </div>
            <div class="equipment-slot monster-slot" data-slot="4" data-cost="999">
                <div class="slot-content">
                    <i class="fa-solid fa-dragon icon-main"></i>
                    <div class="monster-cost">999$</div>
                </div>
            </div>
            <div class="equipment-slot radio-slot off" data-slot="5">
                <div class="slot-content">
                    <i class="fa-solid fa-walkie-talkie icon-main"></i>
                    <div class="battery-indicator radio-battery">
                        <div class="battery-fill radio-battery-fill"></div>
                    </div>
                    <div class="status-indicator radio-status"></div>
                </div>
            </div>
        </div>

        <!-- Flashlight Beam Effect -->
        <div class="flashlight-beam"></div>

        <!-- Radio Transmission Effect -->
        <div class="radio-transmission"></div>
        
        <!-- Teammate Health Status -->
        <div class="teammate-status" id="teammateStatus">
            <div class="scan-line"></div>
            <div class="status-header">
                <span class="comrade-id">EMPLOYEE #4815</span>
                <span class="connection-quality">[BANDWIDTH RESTRICTED]</span>
            </div>
            <div class="teammate-vitals">
                <div class="mate-health-bar">
                    <div class="mate-health-fill" style="width: 35%;">
                        <div class="health-pulse"></div>
                    </div>
                </div>
                <div class="vital-labels">
                    <div class="vital-label">CRITICAL</div>
                    <div class="vital-value">35%</div>
                </div>
            </div>
            <div class="heal-hint">
                <div class="key-button small">F</div>
                <span>APPLY CORPORATE HEALTHCARE</span>
            </div>
            <div class="status-message">"Productivity levels decreasing... need assistance."</div>
            <div class="corner-element top-left"></div>
            <div class="corner-element top-right"></div>
            <div class="corner-element bottom-left"></div>
            <div class="corner-element bottom-right"></div>
        </div>
        
        <!-- Regular Interaction Hint -->
        <div class="interaction-hint" id="regularInteraction">
            <div class="scan-line"></div>
            <div class="object-name">
                <span class="name-text" data-text="Capsule">Capsule</span>
                <span class="object-status">Nothing to place</span>
            </div>
            <div class="interaction-container">
                <div class="key-button">E</div>
                <div class="interaction-text">Interact</div>
            </div>
        </div>
        
        <!-- Hold Interaction Hint -->
        <div class="interaction-hint" id="holdInteraction">
            <div class="scan-line"></div>
            <div class="object-name">
                <span class="name-text" data-text="Capsule">Capsule</span>
                <span class="object-status">Nothing to place</span>
            </div>
            <div class="interaction-container">
                <div class="key-button">
                    <div class="hold-inner">
                        <span>E</span>
                        <div class="hold-progress"></div>
                    </div>
                </div>
                <div class="interaction-text">Hold</div>
            </div>
        </div>
        
        <!-- Button Hints Panel -->
        <div class="button-hints">
            <div class="hints-header">
                <div class="hints-title">CONTROLS GUIDE</div>
                <div class="hints-toggle">H</div>
            </div>
            <div class="hints-description">
                Navigation and interaction with survival system
            </div>
            <div class="hints-content">
                <!-- Movement & Core Controls -->
                <div class="hint-divider">Basic Controls</div>
                <div class="hint-item" data-action="move">
                    <div class="key-button small">WASD</div>
                    <span>Move</span>
                </div>
                <div class="hint-item" data-action="sprint">
                    <div class="key-button small">SHIFT</div>
                    <span>Sprint</span>
                </div>
                <div class="hint-item" data-action="interact">
                    <div class="key-button small">E</div>
                    <span>Interact</span>
                </div>
                <div class="hint-item" data-action="hold-interact">
                    <div class="key-button small">Hold E</div>
                    <span>Hold</span>
                </div>
                
                <!-- Equipment Controls -->
                <div class="hint-divider">Equipment</div>
                <div class="hint-item" data-action="select-slot">
                    <div class="key-button small">1-5</div>
                    <span>Select Item</span>
                </div>
                <div class="hint-item" data-action="toggle-flashlight">
                    <div class="key-button small">L</div>
                    <span>Toggle Flashlight</span>
                </div>
                <div class="hint-item" data-action="toggle-radio">
                    <div class="key-button small">R</div>
                    <span>Toggle Radio</span>
                </div>
                <div class="hint-item" data-action="charge-device">
                    <div class="key-button small">C</div>
                    <span>Charge Battery</span>
                </div>
                <div class="hint-item" data-action="use-firstaid">
                    <div class="key-button small">F</div>
                    <span>First Aid Kit</span>
                </div>
                <div class="hint-item" data-action="select-monster">
                    <div class="key-button small">M</div>
                    <span>Monster</span>
                </div>
                
                <!-- Interface Controls -->
                <div class="hint-divider">Interface</div>
                <div class="hint-item" data-action="objectives">
                    <div class="key-button small">TAB</div>
                    <span>Directive (tasks)</span>
                </div>
                <div class="hint-item" data-action="toggle-interaction">
                    <div class="key-button small">I</div>
                    <span>Toggle Interaction</span>
                </div>
                <div class="hint-item" data-action="controls">
                    <div class="key-button small">H</div>
                    <span>Show Controls</span>
                </div>
                <div class="hint-item" data-action="death-screen">
                    <div class="key-button small">D</div>
                    <span>Simulate Death</span>
                </div>
                <div class="hint-item" data-action="esc-menu">
                    <div class="key-button small">ESC</div>
                    <span>System Access</span>
                </div>
            </div>
        </div>
        
        <!-- Press H for Controls Hint -->
        <div class="press-h-hint">
            Press <span class="key-highlight">H</span> for controls
        </div>
        
        <!-- Dead Players Overlay -->
        <div class="dead-players-overlay" id="deadPlayersOverlay">
            <div class="dead-players-header">
                <div class="scan-line"></div>
                <i class="fa-solid fa-skull"></i>
                <span class="header-text">DECEASED PERSONNEL</span>
                <div class="deceased-count">3</div>
            </div>
            
            <div class="dead-players-list">
                <!-- Dead Player 1 -->
                <div class="dead-player-item" data-player-id="1">
                    <div class="dead-player-avatar">
                        <div class="avatar-inner">
                            <i class="fa-solid fa-user"></i>
                            <div class="skull-overlay">☠</div>
                        </div>
                        <div class="voice-ring"></div>
                    </div>
                    <div class="dead-player-info">
                        <div class="dead-player-name">CHEN, L.</div>
                        <div class="dead-player-status">TERMINATED</div>
                    </div>
                    <div class="voice-indicator">
                        <div class="voice-bars">
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Dead Player 2 -->
                <div class="dead-player-item speaking" data-player-id="2">
                    <div class="dead-player-avatar">
                        <div class="avatar-inner">
                            <i class="fa-solid fa-user"></i>
                            <div class="skull-overlay">☠</div>
                        </div>
                        <div class="voice-ring"></div>
                    </div>
                    <div class="dead-player-info">
                        <div class="dead-player-name">WILLIAMS, K.</div>
                        <div class="dead-player-status">EXPIRED</div>
                    </div>
                    <div class="voice-indicator">
                        <div class="voice-bars">
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Dead Player 3 -->
                <div class="dead-player-item" data-player-id="3">
                    <div class="dead-player-avatar">
                        <div class="avatar-inner">
                            <i class="fa-solid fa-user"></i>
                            <div class="skull-overlay">☠</div>
                        </div>
                        <div class="voice-ring"></div>
                    </div>
                    <div class="dead-player-info">
                        <div class="dead-player-name">MARTINEZ, R.</div>
                        <div class="dead-player-status">ELIMINATED</div>
                    </div>
                    <div class="voice-indicator">
                        <div class="voice-bars">
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="dead-players-footer">
                <div class="footer-text">SPECTATOR MODE ACTIVE</div>
            </div>
            
            <div class="corner-element top-left"></div>
            <div class="corner-element top-right"></div>
            <div class="corner-element bottom-left"></div>
            <div class="corner-element bottom-right"></div>
        </div>
    </div>
    
    <!-- Death Screen -->
    <div id="deathScreen" class="death-screen">
        <div class="death-content">
            <div class="death-header">
                <h1 class="glitch-text" data-text="SYSTEMS OFFLINE">SYSTEMS OFFLINE</h1>
                <h2 data-binary="01000100 01000101 01000001 01000100">MISSION STATUS: <span class="text-danger">CATASTROPHIC FAILURE</span> <span class="binary-code">01000100 01000101 01000001 01000100</span></h2>
            </div>
            
            <div class="death-stats">
                <div class="death-stat">
                    <div class="stat-label">SURVIVAL TIME</div>
                    <div class="stat-value" id="survivalTime">48 min 27 sec</div>
                </div>
                <div class="death-stat">
                    <div class="stat-label">SYSTEM STATUS</div>
                    <div class="stat-value">Observer mode active</div>
                </div>
                <div class="death-stat">
                    <div class="stat-label">DEATH RATING</div>
                    <div class="stat-value">D- (Extremely preventable)</div>
                </div>
            </div>
            
            <div class="death-message-container">
                <div class="death-cause">
                    <h3>CAUSE OF DEATH</h3>
                    <p id="deathCause">Violation of company dress code (spacesuit breach)</p>
                </div>
                <div class="death-analysis">
                    <h3>ONBOARD COMPUTER ANALYSIS</h3>
                    <p id="deathAnalysis">This failure will be noted in your permanent record.</p>
                </div>
            </div>
            
            <button id="restartButton" class="restart-button">
                <div class="button-glow"></div>
                <span class="button-text">OBSERVE</span>
            </button>
            
            <div class="death-decoration">
                <div class="skull-icon">☠</div>
                <div class="system-failure">SYSTEM FAILURE</div>
            </div>
        </div>
    </div>

    <!-- ESC Menu -->
    <div id="escMenu" class="esc-menu">
        <div class="menu-content">
            <div class="menu-header">
                <div class="scan-line"></div>
                <h1 class="menu-title" data-text="SYSTEM ACCESS">SYSTEM ACCESS</h1>
                <div class="menu-subtitle">EMPLOYEE PORTAL v2.4.1</div>
                <div class="menu-warning">UNAUTHORIZED ACCESS WILL BE TERMINATED</div>
                <div class="corner-element top-left"></div>
                <div class="corner-element top-right"></div>
            </div>
            
            <div class="menu-tabs">
                <div class="menu-tab active" data-tab="personnel">PERSONNEL</div>
                <div class="menu-tab" data-tab="settings">SETTINGS</div>
            </div>
            
            <div class="tab-content active" id="personnelTab">
                <div class="menu-section-header">
                    <span>EMPLOYEE DIRECTORY</span>
                    <div class="section-line"></div>
                </div>
                
                <!-- Host ID Section -->
                <div class="server-id-section" id="serverIdSection" style="display: none; opacity: 0; transition: opacity 0.3s ease, margin 0.3s ease; margin-bottom: 0;">
                    <div class="host-id-container">
                        <div class="host-id-label">EXPEDITION DOOM CODE:</div>
                        <div class="host-id-value" id="hostDoomCode">#887766E</div>
                        <button class="copy-id-btn" id="copyHostId" title="Copy to clipboard">
                            <i class="fa-solid fa-copy"></i>
                        </button>
                    </div>
                    <div class="host-id-status">SIGNAL STABLE • <span class="uptime">UPTIME: 01:23:45</span></div>
                </div>
                
                <!-- Toggle Lobby Code Button -->
                <div class="menu-button" id="toggleLobbyCodeBtn" style="margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; background-color: rgba(20, 20, 18, 0.6); border: 1px solid rgba(194, 176, 28, 0.3); cursor: pointer; transition: all 0.3s ease;">
                    <span style="color: var(--primary-color); font-size: 16px; text-transform: uppercase;">
                        <i class="fa-solid fa-eye"></i> SHOW DOOM CODE
                    </span>
                    <i class="fa-solid fa-chevron-down" id="lobbyCodeToggleIcon" style="color: var(--primary-color); transition: transform 0.3s ease;"></i>
                </div>
                
                <div class="player-list">
                    <!-- Host player (you) -->
                    <div class="player-item host">
                        <div class="player-status active"></div>
                        <div class="player-name">
                            <span class="name-text">YOU [HOST]</span>
                            <span class="id-text">ID#4815</span>
                        </div>
                        <div class="player-role">SUPERVISOR</div>
                        <div class="player-controls">
                            <div class="control-label">OUTPUT</div>
                            <div class="microphone-icon active">
                                <i class="fa-solid fa-microphone"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Other players -->
                    <div class="player-item">
                        <div class="player-status active"></div>
                        <div class="player-name">
                            <span class="name-text">SMITH, J.</span>
                            <span class="id-text">ID#1623</span>
                        </div>
                        <div class="player-role">TECHNICIAN</div>
                        <div class="player-controls">
                            <div class="control-label">VOLUME</div>
                            <div class="volume-slider-container">
                                <input type="range" class="volume-slider" min="0" max="100" value="75">
                                <div class="volume-track">
                                    <div class="volume-fill" style="width: 75%"></div>
                                </div>
                            </div>
                            <div class="microphone-icon active">
                                <i class="fa-solid fa-volume-high"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="player-item">
                        <div class="player-status active"></div>
                        <div class="player-name">
                            <span class="name-text">PETERSON, A.</span>
                            <span class="id-text">ID#4421</span>
                        </div>
                        <div class="player-role">SECURITY</div>
                        <div class="player-controls">
                            <div class="control-label">VOLUME</div>
                            <div class="volume-slider-container">
                                <input type="range" class="volume-slider" min="0" max="100" value="60">
                                <div class="volume-track">
                                    <div class="volume-fill" style="width: 60%"></div>
                                </div>
                            </div>
                            <div class="microphone-icon active">
                                <i class="fa-solid fa-volume-high"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="player-item">
                        <div class="player-status disconnected"></div>
                        <div class="player-name">
                            <span class="name-text">RODRIGUEZ, M.</span>
                            <span class="id-text">ID#8890</span>
                        </div>
                        <div class="player-role">MISSING</div>
                        <div class="player-controls">
                            <div class="control-label">SIGNAL LOST</div>
                            <div class="microphone-icon disabled">
                                <i class="fa-solid fa-volume-slash"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="menu-footer">
                    <div class="personnel-note">NOTE: Muting coworkers violates Company Policy #472-B</div>
                    <div class="corporate-message">"Communication is mandatory until termination"</div>
                </div>
            </div>
            
            <div class="tab-content" id="settingsTab">
                <div class="menu-section-header">
                    <span>URGENT SYSTEM CONFIGURATION</span>
                    <div class="section-line"></div>
                </div>
                
                <div class="settings-list">
                    <div class="setting-item">
                        <div class="setting-name">OXYGEN EFFICIENCY</div>
                        <div class="setting-control">
                            <div class="toggle-switch">
                                <div class="toggle-track">
                                    <div class="toggle-indicator active"></div>
                                </div>
                                <div class="toggle-value">-43%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">EMPLOYEE REDUNDANCY</div>
                        <div class="setting-control">
                            <div class="toggle-switch">
                                <div class="toggle-track">
                                    <div class="toggle-indicator active"></div>
                                </div>
                                <div class="toggle-value">HIGH</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">ORGAN DONATION</div>
                        <div class="setting-control">
                            <div class="toggle-switch">
                                <div class="toggle-track">
                                    <div class="toggle-indicator active"></div>
                                </div>
                                <div class="toggle-value">MANDATORY</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">REALITY STABILIZER</div>
                        <div class="setting-control">
                            <div class="toggle-switch">
                                <div class="toggle-track">
                                    <div class="toggle-indicator"></div>
                                </div>
                                <div class="toggle-value">OFF</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">SUFFERING LEVEL</div>
                        <div class="setting-control">
                            <div class="toggle-value">IMMENSE</div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">SCREAMS VOLUME</div>
                        <div class="setting-control">
                            <div class="toggle-value">87dB</div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">NIGHTMARE MODE</div>
                        <div class="setting-control">
                            <div class="toggle-switch">
                                <div class="toggle-track">
                                    <div class="toggle-indicator active"></div>
                                </div>
                                <div class="toggle-value">ALWAYS</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">MEMORY WIPES</div>
                        <div class="setting-control">
                            <div class="toggle-value">BI-WEEKLY</div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">EXISTENTIAL DREAD</div>
                        <div class="setting-control">
                            <div class="toggle-switch">
                                <div class="toggle-track">
                                    <div class="toggle-indicator active"></div>
                                </div>
                                <div class="toggle-value">MAX</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">EMPLOYEE HAPPINESS</div>
                        <div class="setting-control">
                            <div class="toggle-switch">
                                <div class="toggle-track">
                                    <div class="toggle-indicator"></div>
                                </div>
                                <div class="toggle-value">PROHIBITED</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">WALL EYES</div>
                        <div class="setting-control">
                            <div class="toggle-switch">
                                <div class="toggle-track">
                                    <div class="toggle-indicator active"></div>
                                </div>
                                <div class="toggle-value">WATCHING</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">DENTAL PLAN</div>
                        <div class="setting-control">
                            <div class="toggle-switch">
                                <div class="toggle-track">
                                    <div class="toggle-indicator"></div>
                                </div>
                                <div class="toggle-value">UNAVAILABLE</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">PRODUCTIVITY MINIMUM</div>
                        <div class="setting-control">
                            <div class="toggle-value">142%</div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">BATHROOM BREAKS</div>
                        <div class="setting-control">
                            <div class="toggle-value">QUARTERLY</div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-name">PHYSICS STABILITY</div>
                        <div class="setting-control">
                            <div class="toggle-switch">
                                <div class="toggle-track">
                                    <div class="toggle-indicator"></div>
                                </div>
                                <div class="toggle-value">UNRELIABLE</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="menu-footer">
                    <div class="personnel-note">NOTE: These settings cannot be changed without approval from Corporate</div>
                    <div class="corporate-message">"Optimal misery promotes quarterly growth"</div>
                </div>
            </div>
            
            <div class="menu-actions">
                <div class="menu-button" id="resumeButton">
                    <div class="key-button small">ESC</div>
                    <span>RETURN TO WORK</span>
                </div>
                <div class="menu-button" id="optionsButton">
                    <span>FULL SYSTEM OPTIONS</span>
                </div>
                <div class="menu-button" id="logoutButton" onclick="window.location.href='main-menu.html'">
                    <span>VOLUNTARY TERMINATION</span>
                </div>
            </div>
            
            <div class="corner-element bottom-left"></div>
            <div class="corner-element bottom-right"></div>
        </div>
    </div>

    <!-- Ambient Audio -->
    <audio id="ambientMachinery1" preload="auto">
        <source src="sounds/machinery.wav" type="audio/wav">
    </audio>
    <audio id="ambientMachinery2" preload="auto">
        <source src="sounds/machinery.wav" type="audio/wav">
    </audio>
    <audio id="zapperSound" preload="auto">
        <source src="sounds/zapper.wav" type="audio/wav">
    </audio>

    <style>
        /* Electrical Spark Effect */
        .electrical-spark-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.1s ease-out;
        }
        
        .electrical-spark-container.active {
            opacity: 1;
        }
        
        #sparkCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .spark-flash {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at 30% 40%, 
                rgba(194, 176, 28, 0.15) 0%,
                rgba(255, 230, 100, 0.08) 20%,
                transparent 40%);
            opacity: 0;
            animation: electricFlash 0.15s ease-in-out;
        }
        
        .electrical-spark-container.active .spark-flash {
            animation: electricFlash 0.15s ease-in-out infinite;
        }
        
        @keyframes electricFlash {
            0%, 100% {
                opacity: 0;
            }
            10%, 30%, 50%, 70% {
                opacity: 1;
            }
            20%, 40%, 60%, 80% {
                opacity: 0.3;
            }
        }
    </style>

    <script src="script.js"></script>
    <script>
        // Advanced crossfading ambient machinery sound
        const ambientMachinery1 = document.getElementById('ambientMachinery1');
        const ambientMachinery2 = document.getElementById('ambientMachinery2');
        
        const AMBIENT_VOLUME = 0.15;
        const CROSSFADE_DURATION = 2000; // 2 seconds crossfade
        const CROSSFADE_START_OFFSET = 3; // Start crossfade 3 seconds before end
        
        let ambientStarted = false;
        let currentTrack = ambientMachinery1;
        let nextTrack = ambientMachinery2;
        let crossfadeTimer = null;
        
        // Set initial volumes
        ambientMachinery1.volume = 0;
        ambientMachinery2.volume = 0;
        
        // Smooth easing function for natural fade
        function easeInOutCubic(t) {
            return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
        }
        
        // Crossfade to next track
        function crossfade() {
            if (!ambientStarted) return;
            
            console.log('Starting crossfade...');
            
            // Prepare next track
            nextTrack.currentTime = 0;
            nextTrack.volume = 0;
            nextTrack.play().catch(e => console.log('Crossfade play prevented:', e));
            
            const startTime = performance.now();
            const currentStartVolume = currentTrack.volume;
            
            function fade() {
                const elapsed = performance.now() - startTime;
                const progress = Math.min(elapsed / CROSSFADE_DURATION, 1);
                const easedProgress = easeInOutCubic(progress);
                
                // Fade out current, fade in next
                currentTrack.volume = currentStartVolume * (1 - easedProgress);
                nextTrack.volume = AMBIENT_VOLUME * easedProgress;
                
                if (progress < 1) {
                    requestAnimationFrame(fade);
                } else {
                    // Crossfade complete, swap tracks
                    currentTrack.pause();
                    currentTrack.currentTime = 0;
                    
                    // Swap references
                    [currentTrack, nextTrack] = [nextTrack, currentTrack];
                    
                    // Schedule next crossfade
                    scheduleNextCrossfade();
                }
            }
            
            requestAnimationFrame(fade);
        }
        
        // Schedule the next crossfade based on track duration
        function scheduleNextCrossfade() {
            if (crossfadeTimer) {
                clearTimeout(crossfadeTimer);
            }
            
            const duration = currentTrack.duration;
            if (duration && !isNaN(duration)) {
                const timeUntilCrossfade = (duration - CROSSFADE_START_OFFSET) * 1000;
                console.log(`Next crossfade in ${timeUntilCrossfade / 1000}s`);
                crossfadeTimer = setTimeout(crossfade, Math.max(0, timeUntilCrossfade));
            } else {
                // Fallback if duration not available
                crossfadeTimer = setTimeout(crossfade, 25000); // Default 25s
            }
        }
        
        // Start ambient sound system
        function startAmbient() {
            if (!ambientStarted) {
                ambientStarted = true;
                
                // Start first track
                currentTrack.volume = AMBIENT_VOLUME;
                currentTrack.play().catch(e => {
                    console.log('Ambient audio prevented:', e);
                    ambientStarted = false;
                });
                
                // Wait for metadata to load before scheduling
                if (currentTrack.duration && !isNaN(currentTrack.duration)) {
                    scheduleNextCrossfade();
                } else {
                    currentTrack.addEventListener('loadedmetadata', () => {
                        scheduleNextCrossfade();
                    }, { once: true });
                }
                
                console.log('Ambient machinery sound started with crossfading');
            }
        }
        
        // Start on first interaction
        document.addEventListener('click', startAmbient, { once: true });
        document.addEventListener('keydown', startAmbient, { once: true });
        
        // ===================================
        // RANDOM ZAPPER SOUND EFFECT
        // ===================================
        
        const zapperSound = document.getElementById('zapperSound');
        zapperSound.volume = 0.06; // 6% volume for subtle effect
        
        let zapperActive = false;
        
        // ===================================
        // ELECTRICAL SPARK VISUAL EFFECT
        // ===================================
        
        const electricalSparks = document.getElementById('electricalSparks');
        const sparkCanvas = document.getElementById('sparkCanvas');
        const sparkCtx = sparkCanvas.getContext('2d');
        
        // Set canvas to full screen
        function resizeSparkCanvas() {
            sparkCanvas.width = window.innerWidth;
            sparkCanvas.height = window.innerHeight;
        }
        resizeSparkCanvas();
        window.addEventListener('resize', resizeSparkCanvas);
        
        let sparks = [];
        let lightning = [];
        let sparkAnimationRunning = false;
        
        // Spark origin point (cable location - left-center area)
        const sparkOrigin = {
            x: 0.30, // 30% from left
            y: 0.35  // 35% from top
        };
        
        class ElectricSpark {
            constructor(originX, originY) {
                this.x = originX + (Math.random() - 0.5) * 30;
                this.y = originY + (Math.random() - 0.5) * 30;
                this.vx = (Math.random() - 0.5) * 8;
                this.vy = (Math.random() - 0.5) * 8 + 2; // Slight downward bias
                this.life = 1.0;
                this.decay = 0.02 + Math.random() * 0.03;
                this.size = 1.5 + Math.random() * 2.5;
                this.brightness = 0.7 + Math.random() * 0.3;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.2; // Gravity
                this.vx *= 0.98; // Air resistance
                this.life -= this.decay;
            }
            
            draw() {
                const alpha = this.life * this.brightness;
                
                // Main spark particle
                sparkCtx.beginPath();
                sparkCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                sparkCtx.fillStyle = `rgba(255, 240, 150, ${alpha})`;
                sparkCtx.shadowBlur = 15;
                sparkCtx.shadowColor = `rgba(194, 176, 28, ${alpha})`;
                sparkCtx.fill();
                
                // Bright core
                sparkCtx.beginPath();
                sparkCtx.arc(this.x, this.y, this.size * 0.4, 0, Math.PI * 2);
                sparkCtx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                sparkCtx.shadowBlur = 20;
                sparkCtx.fill();
                
                sparkCtx.shadowBlur = 0;
            }
        }
        
        class LightningBolt {
            constructor(startX, startY) {
                this.segments = [];
                this.life = 1.0;
                this.decay = 0.08;
                
                // Create jagged lightning path
                let x = startX;
                let y = startY;
                const endX = startX + (Math.random() - 0.5) * 150;
                const endY = startY + 80 + Math.random() * 100;
                const segmentCount = 8 + Math.floor(Math.random() * 6);
                
                for (let i = 0; i <= segmentCount; i++) {
                    const progress = i / segmentCount;
                    const targetX = startX + (endX - startX) * progress;
                    const targetY = startY + (endY - startY) * progress;
                    
                    x = targetX + (Math.random() - 0.5) * 40;
                    y = targetY + (Math.random() - 0.5) * 20;
                    
                    this.segments.push({ x, y });
                }
            }
            
            update() {
                this.life -= this.decay;
            }
            
            draw() {
                if (this.segments.length < 2) return;
                
                const alpha = this.life;
                
                // Outer glow
                sparkCtx.beginPath();
                sparkCtx.moveTo(this.segments[0].x, this.segments[0].y);
                for (let i = 1; i < this.segments.length; i++) {
                    sparkCtx.lineTo(this.segments[i].x, this.segments[i].y);
                }
                sparkCtx.strokeStyle = `rgba(194, 176, 28, ${alpha * 0.5})`;
                sparkCtx.lineWidth = 4;
                sparkCtx.shadowBlur = 20;
                sparkCtx.shadowColor = `rgba(194, 176, 28, ${alpha})`;
                sparkCtx.stroke();
                
                // Inner bright bolt
                sparkCtx.beginPath();
                sparkCtx.moveTo(this.segments[0].x, this.segments[0].y);
                for (let i = 1; i < this.segments.length; i++) {
                    sparkCtx.lineTo(this.segments[i].x, this.segments[i].y);
                }
                sparkCtx.strokeStyle = `rgba(255, 255, 255, ${alpha})`;
                sparkCtx.lineWidth = 2;
                sparkCtx.shadowBlur = 15;
                sparkCtx.shadowColor = `rgba(255, 255, 255, ${alpha})`;
                sparkCtx.stroke();
                
                sparkCtx.shadowBlur = 0;
            }
        }
        
        function createElectricalEffect() {
            const originX = sparkCanvas.width * sparkOrigin.x;
            const originY = sparkCanvas.height * sparkOrigin.y;
            
            // Create sparks
            for (let i = 0; i < 12; i++) {
                sparks.push(new ElectricSpark(originX, originY));
            }
            
            // Random chance for lightning bolt
            if (Math.random() > 0.4) {
                lightning.push(new LightningBolt(originX, originY));
            }
        }
        
        function animateElectricalEffect() {
            sparkCtx.clearRect(0, 0, sparkCanvas.width, sparkCanvas.height);
            
            // Update and draw lightning
            lightning = lightning.filter(bolt => {
                bolt.update();
                if (bolt.life > 0) {
                    bolt.draw();
                    return true;
                }
                return false;
            });
            
            // Update and draw sparks
            sparks = sparks.filter(spark => {
                spark.update();
                if (spark.life > 0) {
                    spark.draw();
                    return true;
                }
                return false;
            });
            
            // Continue animation if there are effects
            if (sparks.length > 0 || lightning.length > 0) {
                requestAnimationFrame(animateElectricalEffect);
            } else {
                electricalSparks.classList.remove('active');
                sparkAnimationRunning = false;
            }
        }
        
        function triggerElectricalSparks() {
            electricalSparks.classList.add('active');
            
            // Create bursts of sparks during the effect
            const burstInterval = setInterval(() => {
                createElectricalEffect();
            }, 120);
            
            // Start animation if not already running
            if (!sparkAnimationRunning) {
                sparkAnimationRunning = true;
                animateElectricalEffect();
            }
            
            // Stop creating new effects after duration
            setTimeout(() => {
                clearInterval(burstInterval);
            }, 1200);
        }
        
        // Play zapper sound at random intervals with gaps
        function scheduleNextZapper() {
            if (!zapperActive || !ambientStarted) return;
            
            // Random gap between plays: 8-20 seconds
            const gapDuration = 8000 + Math.random() * 12000;
            
            setTimeout(() => {
                if (zapperActive && ambientStarted) {
                    // Play the zapper sound
                    zapperSound.currentTime = 0;
                    zapperSound.play()
                        .then(() => {
                            console.log('⚡ Zapper effect triggered');
                            
                            // Trigger electrical spark visual effect
                            triggerElectricalSparks();
                            
                            // Get the duration of the sound (3-6 seconds typically)
                            const soundDuration = zapperSound.duration || 4.5; // fallback to 4.5s
                            
                            // After sound finishes, schedule the next one
                            setTimeout(() => {
                                scheduleNextZapper();
                            }, soundDuration * 1000);
                        })
                        .catch(e => {
                            console.log('Zapper play prevented:', e);
                            // Try again even if failed
                            scheduleNextZapper();
                        });
                } else {
                    // If conditions not met, try again later
                    scheduleNextZapper();
                }
            }, gapDuration);
        }
        
        // Start zapper system
        function startZapperSystem() {
            if (!zapperActive && ambientStarted) {
                zapperActive = true;
                console.log('🔌 Random zapper system activated');
                
                // First zapper after initial delay (5-10 seconds)
                setTimeout(() => {
                    if (zapperActive && ambientStarted) {
                        zapperSound.currentTime = 0;
                        zapperSound.play()
                            .then(() => {
                                console.log('⚡ Initial zapper effect');
                                
                                // Trigger electrical spark visual effect
                                triggerElectricalSparks();
                                
                                // Wait for sound to finish, then schedule next
                                const soundDuration = zapperSound.duration || 4.5;
                                setTimeout(() => {
                                    scheduleNextZapper();
                                }, soundDuration * 1000);
                            })
                            .catch(e => {
                                console.log('Initial zapper prevented:', e);
                                scheduleNextZapper();
                            });
                    }
                }, 5000 + Math.random() * 5000);
            }
        }
        
        // Auto-start zapper when ambient starts
        document.addEventListener('click', () => {
            setTimeout(() => {
                if (ambientStarted && !zapperActive) {
                    startZapperSystem();
                }
            }, 1000);
        }, { once: true });
        
        document.addEventListener('keydown', () => {
            setTimeout(() => {
                if (ambientStarted && !zapperActive) {
                    startZapperSystem();
                }
            }, 1000);
        }, { once: true });
        
        // Toggle Lobby Code visibility
        document.getElementById('toggleLobbyCodeBtn').addEventListener('click', function() {
            const serverIdSection = document.getElementById('serverIdSection');
            const toggleBtn = document.getElementById('toggleLobbyCodeBtn');
            const toggleIcon = document.getElementById('lobbyCodeToggleIcon');
            const toggleText = toggleBtn.querySelector('span');
            
            if (serverIdSection.style.display === 'none') {
                // Show the section
                serverIdSection.style.display = 'block';
                setTimeout(() => {
                    serverIdSection.style.opacity = '1';
                    serverIdSection.style.marginBottom = '25px';
                }, 10);
                toggleText.innerHTML = '<i class="fa-solid fa-eye-slash"></i> HIDE DOOM CODE';
                toggleIcon.style.transform = 'rotate(180deg)';
            } else {
                // Hide the section
                serverIdSection.style.opacity = '0';
                serverIdSection.style.marginBottom = '0';
                setTimeout(() => {
                    serverIdSection.style.display = 'none';
                }, 300);
                toggleText.innerHTML = '<i class="fa-solid fa-eye"></i> SHOW DOOM CODE';
                toggleIcon.style.transform = 'rotate(0deg)';
            }
        });
        
        // Add hover effect to toggle button
        document.getElementById('toggleLobbyCodeBtn').addEventListener('mouseenter', function() {
            this.style.backgroundColor = 'rgba(194, 176, 28, 0.1)';
            this.style.borderColor = 'var(--primary-color)';
        });
        
        document.getElementById('toggleLobbyCodeBtn').addEventListener('mouseleave', function() {
            this.style.backgroundColor = 'rgba(20, 20, 18, 0.6)';
            this.style.borderColor = 'rgba(194, 176, 28, 0.3)';
        });
        
        // Host ID copy functionality
        document.getElementById('copyHostId').addEventListener('click', function() {
            const hostId = document.getElementById('hostDoomCode').textContent;
            navigator.clipboard.writeText(hostId).then(function() {
                // Show copy success feedback
                const copyBtn = document.getElementById('copyHostId');
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<i class="fa-solid fa-check"></i>';
                copyBtn.style.backgroundColor = 'rgba(77, 110, 80, 0.5)';
                
                setTimeout(function() {
                    copyBtn.innerHTML = originalHTML;
                    copyBtn.style.backgroundColor = '';
                }, 1000);
                
                // Add a notification
                showNotification('Doom Code copied to clipboard. Spread the suffering.', 'info');
            });
        });
        
        // Generate a random Doom Code if not already set
        function generateDoomCode() {
            const joinedServerCode = localStorage.getItem('joinedServerCode');
            const storedDoomCode = localStorage.getItem('hostDoomCode');
            const hostDoomCodeElement = document.getElementById('hostDoomCode');
            
            // Check if joining someone else's server
            if (joinedServerCode) {
                hostDoomCodeElement.textContent = joinedServerCode;
                const statusElement = document.querySelector('.host-id-status');
                statusElement.innerHTML = 'CONNECTED TO EXTERNAL SIGNAL • <span class="uptime">UPTIME: 01:23:45</span>';
                statusElement.style.color = '#a23430';
                
                // Set the player role to "SUBORDINATE" instead of "SUPERVISOR"
                const playerRole = document.querySelector('.player-role');
                if (playerRole.textContent === 'SUPERVISOR') {
                    playerRole.textContent = 'SUBORDINATE';
                    
                    // Update player display to show as non-host
                    const playerItem = document.querySelector('.player-item.host');
                    playerItem.classList.remove('host');
                    const nameText = playerItem.querySelector('.name-text');
                    nameText.textContent = 'YOU [CONNECTED]';
                }
                
                // Clear the joined server code to avoid confusion on refresh
                localStorage.removeItem('joinedServerCode');
                return;
            }
            
            // Generate a new code or use stored one
            if (storedDoomCode) {
                hostDoomCodeElement.textContent = storedDoomCode;
            } else {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let doomCode = '#';
                for (let i = 0; i < 7; i++) {
                    doomCode += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                hostDoomCodeElement.textContent = doomCode;
                localStorage.setItem('hostDoomCode', doomCode);
            }
        }
        
        // Simple notification system
        function showNotification(message, type = 'info') {
            const notificationContainer = document.querySelector('.game-ui');
            const notification = document.createElement('div');
            notification.className = 'system-notification ' + type;
            notification.innerHTML = `
                <div class="notification-icon"><i class="fa-solid fa-${type === 'info' ? 'info' : 'warning'}"></i></div>
                <div class="notification-message">${message}</div>
            `;
            
            notificationContainer.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notificationContainer.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Update uptime counter
        function updateUptime() {
            const startTime = localStorage.getItem('sessionStartTime') || Date.now().toString();
            if (!localStorage.getItem('sessionStartTime')) {
                localStorage.setItem('sessionStartTime', startTime);
            }
            
            const uptimeElement = document.querySelector('.uptime');
            const elapsedSeconds = Math.floor((Date.now() - parseInt(startTime)) / 1000);
            const hours = Math.floor(elapsedSeconds / 3600).toString().padStart(2, '0');
            const minutes = Math.floor((elapsedSeconds % 3600) / 60).toString().padStart(2, '0');
            const seconds = (elapsedSeconds % 60).toString().padStart(2, '0');
            
            uptimeElement.textContent = `UPTIME: ${hours}:${minutes}:${seconds}`;
        }
        
        // Add terminal shortcut (T key)
        document.addEventListener('keydown', function(event) {
            // Check if T key is pressed and no input element is focused
            if (event.key === 't' || event.key === 'T') {
                const activeElement = document.activeElement;
                const isInputFocused = activeElement.tagName === 'INPUT' || 
                                      activeElement.tagName === 'TEXTAREA' || 
                                      activeElement.isContentEditable;
                
                if (!isInputFocused) {
                    // Show notification before navigating
                    showNotification('Accessing terminal system...', 'info');
                    
                    // Navigate to terminal.html after a brief delay
                    setTimeout(() => {
                        window.location.href = 'terminal.html';
                    }, 500);
                }
            }
            
            // Check if B key is pressed for loading screen shortcut
            if (event.key === 'b' || event.key === 'B') {
                const activeElement = document.activeElement;
                const isInputFocused = activeElement.tagName === 'INPUT' || 
                                      activeElement.tagName === 'TEXTAREA' || 
                                      activeElement.isContentEditable;
                
                if (!isInputFocused) {
                    // Show notification before navigating
                    showNotification('Initiating loading sequence...', 'info');
                    
                    // Navigate to loading.html after a brief delay
                    setTimeout(() => {
                        window.location.href = 'loading.html';
                    }, 500);
                }
            }
        });
        
        // ===================================
        // VOICE LEVEL INDICATOR FUNCTIONALITY
        // ===================================
        
        let audioContext;
        let analyser;
        let microphone;
        let dataArray;
        
        // Initialize voice level monitoring
        async function initVoiceLevel() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                
                analyser.fftSize = 256;
                const bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);
                
                microphone.connect(analyser);
                
                // Update voice bars continuously
                updateVoiceBars();
                
                console.log('Voice level monitoring initialized');
            } catch (err) {
                console.warn('Microphone access denied or unavailable:', err);
                // Fallback to demo mode
                demoVoiceBars();
            }
        }
        
        // Update voice bars based on microphone input
        function updateVoiceBars() {
            if (!analyser) return;
            
            analyser.getByteFrequencyData(dataArray);
            
            // Calculate average volume
            let sum = 0;
            for (let i = 0; i < dataArray.length; i++) {
                sum += dataArray[i];
            }
            const average = sum / dataArray.length;
            const normalizedVolume = average / 255; // 0 to 1
            
            // Update each bar based on volume level
            const voiceBars = document.querySelectorAll('.voice-bar');
            voiceBars.forEach((bar, index) => {
                const threshold = (index + 1) * 0.15; // Progressive thresholds
                if (normalizedVolume > threshold) {
                    const height = Math.min(100, 20 + (normalizedVolume * 80));
                    bar.style.height = height + '%';
                    bar.style.background = `linear-gradient(to top, rgba(194, 176, 28, 0.9), rgba(194, 176, 28, 0.4))`;
                } else {
                    bar.style.height = (20 + (index * 10)) + '%';
                    bar.style.background = `linear-gradient(to top, rgba(194, 176, 28, 0.4), rgba(194, 176, 28, 0.2))`;
                }
            });
            
            // Update status text based on volume
            const statusText = document.querySelector('.voice-status-text');
            if (normalizedVolume > 0.5) {
                statusText.textContent = 'LOUD!!';
                statusText.style.color = '#ff4444';
            } else if (normalizedVolume > 0.2) {
                statusText.textContent = 'MIC OK';
                statusText.style.color = 'var(--primary-color)';
            } else {
                statusText.textContent = 'QUIET';
                statusText.style.color = 'rgba(194, 176, 28, 0.5)';
            }
            
            requestAnimationFrame(updateVoiceBars);
        }
        
        // Demo mode (when mic access is unavailable)
        function demoVoiceBars() {
            setInterval(() => {
                const voiceBars = document.querySelectorAll('.voice-bar');
                voiceBars.forEach((bar, index) => {
                    const randomHeight = 20 + Math.random() * 60;
                    bar.style.height = randomHeight + '%';
                });
            }, 300);
        }
        
        // Initialize the Doom Code and uptime
        document.addEventListener('DOMContentLoaded', function() {
            generateDoomCode();
            updateUptime();
            setInterval(updateUptime, 1000);
            
            // Initialize voice level monitoring after a short delay
            setTimeout(() => {
                initVoiceLevel();
            }, 1000);
            
            // Add hints about terminal access and loading screen
            const controlsHints = document.querySelector('.hints-content');
            if (controlsHints) {
                const interfaceControls = Array.from(controlsHints.querySelectorAll('.hint-divider')).find(div => div.textContent === 'Interface');
                if (interfaceControls) {
                    // Add terminal hint
                    const terminalHint = document.createElement('div');
                    terminalHint.className = 'hint-item';
                    terminalHint.dataset.action = 'terminal';
                    terminalHint.innerHTML = `
                        <div class="key-button small">T</div>
                        <span>Open Terminal</span>
                    `;
                    interfaceControls.parentNode.insertBefore(terminalHint, interfaceControls.nextSibling);
                    
                    // Add loading screen hint
                    const loadingHint = document.createElement('div');
                    loadingHint.className = 'hint-item';
                    loadingHint.dataset.action = 'loading';
                    loadingHint.innerHTML = `
                        <div class="key-button small">B</div>
                        <span>Boot Sequence</span>
                    `;
                    interfaceControls.parentNode.insertBefore(loadingHint, interfaceControls.nextSibling);
                }
            }
        });
        
        // ===================================
        // DEAD PLAYERS OVERLAY FUNCTIONALITY
        // ===================================
        
        // Function to simulate voice activity (for demo purposes)
        // In a real implementation, this would be triggered by actual voice detection
        function simulateVoiceActivity() {
            const deadPlayerItems = document.querySelectorAll('.dead-player-item');
            
            // Randomly make one player speak
            setInterval(() => {
                // Remove speaking class from all players
                deadPlayerItems.forEach(item => item.classList.remove('speaking'));
                
                // Random chance for a player to speak
                if (Math.random() > 0.7) {
                    const randomIndex = Math.floor(Math.random() * deadPlayerItems.length);
                    const speakingPlayer = deadPlayerItems[randomIndex];
                    speakingPlayer.classList.add('speaking');
                    
                    // Remove speaking class after random duration (1-3 seconds)
                    const speakDuration = 1000 + Math.random() * 2000;
                    setTimeout(() => {
                        speakingPlayer.classList.remove('speaking');
                    }, speakDuration);
                }
            }, 3000); // Check every 3 seconds
        }
        
        // Function to manually trigger voice activity for a specific player
        // Usage: triggerVoiceActivity(playerId, duration)
        window.triggerVoiceActivity = function(playerId, duration = 2000) {
            const playerElement = document.querySelector(`.dead-player-item[data-player-id="${playerId}"]`);
            if (playerElement) {
                playerElement.classList.add('speaking');
                
                // Auto-remove after duration
                setTimeout(() => {
                    playerElement.classList.remove('speaking');
                }, duration);
            }
        };
        
        // Function to add a dead player dynamically
        window.addDeadPlayer = function(playerName, playerId, status = 'TERMINATED') {
            const deadPlayersList = document.querySelector('.dead-players-list');
            const deceasedCount = document.querySelector('.deceased-count');
            const toggleCount = document.querySelector('.toggle-count');
            
            if (!deadPlayersList) return;
            
            // Create new dead player item
            const deadPlayerItem = document.createElement('div');
            deadPlayerItem.className = 'dead-player-item';
            deadPlayerItem.dataset.playerId = playerId;
            deadPlayerItem.innerHTML = `
                <div class="dead-player-avatar">
                    <div class="avatar-inner">
                        <i class="fa-solid fa-user"></i>
                        <div class="skull-overlay">☠</div>
                    </div>
                    <div class="voice-ring"></div>
                </div>
                <div class="dead-player-info">
                    <div class="dead-player-name">${playerName}</div>
                    <div class="dead-player-status">${status}</div>
                </div>
                <div class="voice-indicator">
                    <div class="voice-bars">
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                    </div>
                </div>
            `;
            
            // Add to list
            deadPlayersList.appendChild(deadPlayerItem);
            
            // Update counts
            const currentCount = parseInt(deceasedCount.textContent) || 0;
            const newCount = currentCount + 1;
            deceasedCount.textContent = newCount;
            if (toggleCount) toggleCount.textContent = newCount;
            
            // Show notification
            showNotification(`${playerName} has been eliminated`, 'warning');
        };
        
        // Function to remove a dead player
        window.removeDeadPlayer = function(playerId) {
            const playerElement = document.querySelector(`.dead-player-item[data-player-id="${playerId}"]`);
            const deceasedCount = document.querySelector('.deceased-count');
            const toggleCount = document.querySelector('.toggle-count');
            
            if (playerElement) {
                // Fade out animation
                playerElement.style.transition = 'all 0.3s ease';
                playerElement.style.opacity = '0';
                playerElement.style.transform = 'translateX(50px)';
                
                setTimeout(() => {
                    playerElement.remove();
                    
                    // Update counts
                    const currentCount = parseInt(deceasedCount.textContent) || 0;
                    const newCount = Math.max(0, currentCount - 1);
                    deceasedCount.textContent = newCount;
                    if (toggleCount) toggleCount.textContent = newCount;
                }, 300);
            }
        };
        
        // Timer for auto-hiding the button
        let buttonHideTimer = null;
        
        // Function to show the toggle button temporarily
        window.showDeadPlayersButton = function() {
            const toggleButton = document.getElementById('deadPlayersToggle');
            if (toggleButton) {
                toggleButton.classList.add('visible');
                
                // Clear existing timer
                if (buttonHideTimer) {
                    clearTimeout(buttonHideTimer);
                }
                
                // Set new timer to hide after 5 seconds
                buttonHideTimer = setTimeout(() => {
                    toggleButton.classList.remove('visible');
                    // Also close the overlay when button hides
                    const overlay = document.getElementById('deadPlayersOverlay');
                    if (overlay && overlay.classList.contains('visible')) {
                        overlay.classList.remove('visible');
                        toggleButton.classList.remove('active');
                    }
                }, 5000);
            }
        };
        
        // Function to toggle overlay visibility
        window.toggleDeadPlayersOverlay = function() {
            const overlay = document.getElementById('deadPlayersOverlay');
            const toggleButton = document.getElementById('deadPlayersToggle');
            
            if (overlay) {
                const isVisible = overlay.classList.contains('visible');
                
                if (isVisible) {
                    overlay.classList.remove('visible');
                    toggleButton.classList.remove('active');
                } else {
                    overlay.classList.add('visible');
                    toggleButton.classList.add('active');
                    
                    // Keep button visible while overlay is open
                    if (buttonHideTimer) {
                        clearTimeout(buttonHideTimer);
                    }
                }
            }
        };
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Start simulating voice activity for demo
            simulateVoiceActivity();
            
            // Add click event to toggle button
            const toggleButton = document.getElementById('deadPlayersToggle');
            if (toggleButton) {
                toggleButton.addEventListener('click', function() {
                    toggleDeadPlayersOverlay();
                    // Refresh the timer when button is clicked
                    showDeadPlayersButton();
                });
                
                // Pause auto-hide timer when hovering over button
                toggleButton.addEventListener('mouseenter', function() {
                    if (buttonHideTimer) {
                        clearTimeout(buttonHideTimer);
                    }
                });
                
                // Resume auto-hide timer when mouse leaves
                toggleButton.addEventListener('mouseleave', function() {
                    showDeadPlayersButton();
                });
            }
            
            // Add keyboard shortcut to show button and toggle overlay (V key)
            document.addEventListener('keydown', function(event) {
                if (event.key === 'v' || event.key === 'V') {
                    const activeElement = document.activeElement;
                    const isInputFocused = activeElement.tagName === 'INPUT' || 
                                          activeElement.tagName === 'TEXTAREA' || 
                                          activeElement.isContentEditable;
                    
                    if (!isInputFocused) {
                        // Show the button first
                        showDeadPlayersButton();
                        // Then toggle the overlay
                        toggleDeadPlayersOverlay();
                    }
                }
            });
            
            // Add hint for dead players overlay toggle
            const controlsHints = document.querySelector('.hints-content');
            if (controlsHints) {
                const interfaceControls = Array.from(controlsHints.querySelectorAll('.hint-divider'))
                    .find(div => div.textContent === 'Interface');
                if (interfaceControls) {
                    const deadPlayersHint = document.createElement('div');
                    deadPlayersHint.className = 'hint-item';
                    deadPlayersHint.dataset.action = 'dead-players';
                    deadPlayersHint.innerHTML = `
                        <div class="key-button small">V</div>
                        <span>Toggle Dead Players</span>
                    `;
                    interfaceControls.parentNode.insertBefore(deadPlayersHint, interfaceControls.nextSibling);
                }
            }
        });
    </script>
</body>
</html>
